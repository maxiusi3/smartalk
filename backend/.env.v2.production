# SmarTalk V2 Production Environment Configuration
# Generated: 2025-01-02
# Version: V2.0.0

# ===== DATABASE CONFIGURATION =====
DATABASE_URL="postgresql://smartalk_user:${POSTGRES_PASSWORD}@postgres:5432/smartalk_v2_prod"
POSTGRES_DB=smartalk_v2_prod
POSTGRES_USER=smartalk_user
POSTGRES_PASSWORD=${POSTGRES_PASSWORD}

# ===== SERVER CONFIGURATION =====
NODE_ENV=production
PORT=3001
HOST=0.0.0.0
API_VERSION=v2

# ===== SECURITY =====
JWT_SECRET=${JWT_SECRET}
JWT_EXPIRES_IN=7d
CORS_ORIGIN=https://app.smartalk.com,https://smartalk.com
RATE_LIMIT_WINDOW=900000
RATE_LIMIT_MAX=100

# ===== 讯飞 (IFLYTEK) API CONFIGURATION =====
IFLYTEK_APP_ID=${IFLYTEK_APP_ID}
IFLYTEK_API_KEY=${IFLYTEK_API_KEY}
IFLYTEK_API_SECRET=${IFLYTEK_API_SECRET}
IFLYTEK_BASE_URL=https://api.xfyun.cn
IFLYTEK_TIMEOUT=1500
IFLYTEK_RETRY_ATTEMPTS=3

# ===== ELSA API CONFIGURATION =====
ELSA_API_KEY=${ELSA_API_KEY}
ELSA_BASE_URL=https://api.elsaspeak.com
ELSA_TIMEOUT=1500
ELSA_RETRY_ATTEMPTS=3

# ===== CDN CONFIGURATION =====
CDN_PROVIDER=cloudflare
CDN_BASE_URL=https://cdn.smartalk.com
CLOUDFLARE_API_TOKEN=${CLOUDFLARE_API_TOKEN}
CLOUDFLARE_ZONE_ID=${CLOUDFLARE_ZONE_ID}
CDN_VIDEO_CACHE_TTL=86400
CDN_AUDIO_CACHE_TTL=86400
CDN_IMAGE_CACHE_TTL=604800

# ===== FILE STORAGE CONFIGURATION =====
STORAGE_PROVIDER=s3
AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
AWS_REGION=ap-southeast-1
AWS_S3_BUCKET=smartalk-v2-content
AWS_S3_VIDEO_BUCKET=smartalk-v2-videos
AWS_S3_AUDIO_BUCKET=smartalk-v2-audio

# File Upload Limits
MAX_FILE_SIZE=104857600
MAX_VIDEO_SIZE=52428800
MAX_AUDIO_SIZE=5242880
MAX_IMAGE_SIZE=1048576

# Allowed Formats
ALLOWED_VIDEO_FORMATS=mp4,webm,mov
ALLOWED_AUDIO_FORMATS=mp3,aac,wav
ALLOWED_IMAGE_FORMATS=jpg,jpeg,png,webp
ALLOWED_SUBTITLE_FORMATS=srt,vtt

# ===== V2 PERFORMANCE TARGETS =====
VIDEO_LOADING_TARGET=1000
API_RESPONSE_TARGET=1500
STARTUP_TIME_TARGET=2000
SUBTITLE_SYNC_PRECISION=100

# ===== V2 CONTENT VALIDATION =====
ENFORCE_5_KEYWORDS=true
ENFORCE_30_SECOND_DURATION=true
DURATION_TOLERANCE=0.5
KEYWORD_EXTRACTION_AI_PROVIDER=openai
SUBTITLE_GENERATION_PROVIDER=whisper

# ===== V2 ERROR RECOVERY CONFIGURATION =====
FOCUS_MODE_ENABLED=true
RESCUE_MODE_ENABLED=true
FOCUS_MODE_TRIGGER_THRESHOLD=2
RESCUE_MODE_TRIGGER_THRESHOLD=3
FOCUS_MODE_PHASES=context_guessing
RESCUE_MODE_PHASES=pronunciation_training

# ===== V2 VIDEO PLAYER CONFIGURATION =====
DUAL_MODE_ENABLED=true
TEASER_MODE_SUBTITLES=true
MAGIC_MOMENT_MODE_SUBTITLES=false
MODE_SWITCH_ANIMATION=fade
MODE_SWITCH_DURATION=300
SUBTITLE_HIGHLIGHT_EFFECTS=bounce,glow,pulse

# ===== ANALYTICS CONFIGURATION =====
ANALYTICS_ENABLED=true
MIXPANEL_TOKEN=${MIXPANEL_TOKEN}
GOOGLE_ANALYTICS_ID=${GOOGLE_ANALYTICS_ID}
TRACK_USER_INTERACTIONS=true
TRACK_PERFORMANCE_METRICS=true
TRACK_ERROR_RECOVERY=true

# ===== MONITORING CONFIGURATION =====
SENTRY_DSN=${SENTRY_DSN}
LOG_LEVEL=info
HEALTH_CHECK_INTERVAL=30000
PERFORMANCE_MONITORING=true
ERROR_TRACKING=true

# ===== REDIS CONFIGURATION =====
REDIS_URL=redis://redis:6379
REDIS_PASSWORD=${REDIS_PASSWORD}
REDIS_DB=0
REDIS_CACHE_TTL=3600
REDIS_SESSION_TTL=86400

# ===== PRONUNCIATION ASSESSMENT =====
PRONUNCIATION_PROVIDERS=iflytek,elsa
PRIMARY_PRONUNCIATION_PROVIDER=iflytek
FALLBACK_PRONUNCIATION_PROVIDER=elsa
PRONUNCIATION_SCORE_THRESHOLD=70
RESCUE_MODE_SCORE_THRESHOLD=60
PRONUNCIATION_FEEDBACK_LANGUAGE=zh-CN

# ===== CONTENT MANAGEMENT =====
WIZARD_STEPS_ENABLED=true
WIZARD_STEP_COUNT=5
ASSET_VALIDATION_ENABLED=true
QUALITY_ASSURANCE_ENABLED=true
CONTENT_APPROVAL_REQUIRED=true

# ===== GAMIFICATION =====
AQUA_POINTS_ENABLED=true
AQUA_POINTS_PER_SUCCESS=10
AQUA_POINTS_PER_COMPLETION=50
BADGE_SYSTEM_ENABLED=true
ACHIEVEMENT_TRACKING=true

# ===== MAGIC MOMENT CONFIGURATION =====
MAGIC_MOMENT_ENABLED=true
MAGIC_MOMENT_TRIGGER_COMPLETION=5
MAGIC_MOMENT_CELEBRATION_DURATION=3000
MAGIC_MOMENT_BADGE_AWARD=true

# ===== STORY DRIVEN LEARNING =====
STORY_PROCESSING_ENABLED=true
AUTO_SUBTITLE_GENERATION=true
KEYWORD_EXTRACTION_ENABLED=true
CONTEXT_EMBEDDING_ENABLED=true
VIDEO_CLIP_GENERATION=true

# ===== ASSET VALIDATION RULES =====
# Main Video Rules
MAIN_VIDEO_REQUIRED_DURATION=30
MAIN_VIDEO_DURATION_TOLERANCE=0.5
MAIN_VIDEO_MIN_RESOLUTION_WIDTH=1280
MAIN_VIDEO_MIN_RESOLUTION_HEIGHT=720
MAIN_VIDEO_MAX_FILE_SIZE=52428800
MAIN_VIDEO_REQUIRED_CODEC=h264

# Audio File Rules
AUDIO_MIN_DURATION=1
AUDIO_MAX_DURATION=10
AUDIO_MIN_SAMPLE_RATE=22050
AUDIO_MAX_FILE_SIZE=5242880
AUDIO_MIN_QUALITY=128

# Video Clip Rules
VIDEO_CLIP_MIN_DURATION=2
VIDEO_CLIP_MAX_DURATION=8
VIDEO_CLIP_MIN_COUNT=2
VIDEO_CLIP_MAX_COUNT=4
VIDEO_CLIP_MIN_RESOLUTION_WIDTH=854
VIDEO_CLIP_MIN_RESOLUTION_HEIGHT=480

# Rescue Video Rules
RESCUE_VIDEO_MIN_DURATION=3
RESCUE_VIDEO_MAX_DURATION=15
RESCUE_VIDEO_REQUIRED_SLOW_MOTION=true
RESCUE_VIDEO_REQUIRED_CLOSE_UP=true

# Thumbnail Rules
THUMBNAIL_MIN_WIDTH=300
THUMBNAIL_MIN_HEIGHT=200
THUMBNAIL_MAX_WIDTH=1920
THUMBNAIL_MAX_HEIGHT=1080
THUMBNAIL_ASPECT_RATIO=1.777778
THUMBNAIL_MAX_FILE_SIZE=512000

# ===== FEATURE FLAGS =====
FEATURE_STORY_DRIVEN_LEARNING=true
FEATURE_DUAL_MODE_PLAYER=true
FEATURE_FOCUS_MODE=true
FEATURE_RESCUE_MODE=true
FEATURE_ASSET_VALIDATION=true
FEATURE_5_KEYWORD_VALIDATION=true
FEATURE_PRONUNCIATION_DUAL_API=true
FEATURE_SUBTITLE_HIGHLIGHTING=true
FEATURE_CONTENT_WIZARD=true
FEATURE_MAGIC_MOMENT=true

# ===== DEPLOYMENT METADATA =====
DEPLOYMENT_VERSION=v2.0.0
DEPLOYMENT_DATE=2025-01-02
DEPLOYMENT_ENVIRONMENT=production
DEPLOYMENT_COMMIT_SHA=${GITHUB_SHA}
DEPLOYMENT_BUILD_NUMBER=${BUILD_NUMBER}

# ===== BACKUP AND RECOVERY =====
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=smartalk-v2-backups

# ===== SSL AND SECURITY =====
SSL_ENABLED=true
HSTS_ENABLED=true
CSP_ENABLED=true
HELMET_ENABLED=true
TRUST_PROXY=true

# ===== LOAD BALANCING =====
CLUSTER_MODE=true
CLUSTER_WORKERS=auto
LOAD_BALANCER_HEALTH_CHECK=/api/v2/health
GRACEFUL_SHUTDOWN_TIMEOUT=30000

# ===== EXTERNAL SERVICES =====
OPENAI_API_KEY=${OPENAI_API_KEY}
WHISPER_API_KEY=${WHISPER_API_KEY}
STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
SENDGRID_API_KEY=${SENDGRID_API_KEY}

# ===== DEVELOPMENT OVERRIDES (Remove in production) =====
# DEBUG_MODE=false
# MOCK_APIS=false
# SKIP_AUTH=false
